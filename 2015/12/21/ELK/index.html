<!DOCTYPE html>
<html lang="zh-Hant-TW">

	

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title> 墨 痕 </title>
	<meta property="og:title" content=" Elasticsearch、Logstash、Kibana | Hexo " />
	<meta name="twitter:title" content=" Elasticsearch、Logstash、Kibana | Hexo ">

	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary">

	<meta name="description" content=" Elasticsearch、Logstash、Kibana | Hexo ">
	<meta property="og:description" content=" Elasticsearch、Logstash、Kibana | Hexo " />
	<meta name="twitter:description" content=" Elasticsearch、Logstash、Kibana | Hexo " />

	<link rel="icon" type="image/x-icon" href="http://yoursite.com/asset/img/favicon.png">

	<link rel="image_src" href="http://yoursite.com/asset/img/logo.png" >
	<meta property="og:image" content="http://yoursite.com/asset/img/logo.png" />

	
	<link href="http://yoursite.com/atom.xml" title="Hexo" type="application/atom+xml" rel="alternative">
	

	<link rel="canonical" href="/2015/12/21/ELK/index.html">

	<link rel="stylesheet" href="/asset/css/main.css">

</head>


<body>

	
	<header class="site-header">

		
		<nav class="nav-page">

			<div class="row">

				<ul>

					

					<li><a href="/">Home</a></li>

					

					<li><a href="/archives">Sitemap</a></li>

					

					<li><a href="/atom.xml">Rss</a></li>

					

				</ul>

			</div>

		</nav>


		<div class="site-header-main">

			<div class="row">

				<h1><a href="/">墨 痕</a></h1>
				<h6><a href="/">fatesai#gmail.com</a></h6>

				

			</div>

		</div>

		


		<nav class="nav-cat">

			<div class="row">

				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Bigdata/">Bigdata</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OPS/">OPS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/OPS/Bigdata/">Bigdata</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a></li></ul>

			</div>

		</nav>




	</header>


	<div id="content" class="site-content">

		
		<div class="row content-post">
			<article itemscope itemtype="http://schema.org/Article">

				

				

				<p class="content-meta">
					<span class="meta-date" itemprop="datePublished" content="2015-12-21">2015-12-21</span>

					
					  <span class="meta-cat">
						<a class="category-link" href="/categories/OPS/">OPS</a>
					  </span>
					
				</p>

				

					<h2 class="content-title">
						<a href="/2015/12/21/ELK/" itemprop="url"><span itemprop="name">Elasticsearch、Logstash、Kibana</span></a>
					</h2>

				


				<div class="content" itemprop="articleBody">
					<h2 id="基础环境"><strong>基础环境</strong></h2><ul>
<li>CentOS release 6.4 (Final) 64bit</li>
<li>jdk-8u45-linux-x64</li>
<li>Elasticsearch 1.7.1</li>
<li>Kibana-4.1.1-linux-x64</li>
<li>Logstash-1.5.4-1/Logstash-forwarder-0.4.0-1.x86_64</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/java</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/tools.jar:<span class="variable">$JAVA_HOME</span>/lib/dt.jar</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=/usr/<span class="built_in">local</span>/java/jre</span><br><span class="line"></span><br><span class="line">[root@mogl ~]<span class="comment"># java -version</span></span><br><span class="line">java version <span class="string">"1.8.0_45"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build <span class="number">1.8</span>.<span class="number">0</span>_45-b14)</span><br><span class="line">Java HotSpot(TM) <span class="number">64</span>-Bit Server VM (build <span class="number">25.45</span>-b02, mixed mode)</span><br></pre></td></tr></table></figure>
<h2 id="Elasticsearch"><strong>Elasticsearch</strong></h2><h3 id="安装"><strong>安装</strong></h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&gt;</span> wget <span class="symbol">https:</span>/<span class="regexp">/download.elastic.co/elasticsearch</span><span class="regexp">/elasticsearch/elasticsearch</span>-<span class="number">1.7</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="variable">$&gt;</span> tar -zxf elasticsearch-<span class="number">1.7</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="variable">$&gt;</span> mv elasticsearch-<span class="number">1.7</span>.<span class="number">1</span> /usr/local/elasticsearch</span><br></pre></td></tr></table></figure>
<h3 id="配置"><strong>配置</strong></h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$&gt; vim /usr/local/elasticsearch/config/elasticsearch<span class="class">.yml</span></span><br><span class="line"></span><br><span class="line">path<span class="class">.data</span>: /data</span><br><span class="line">path<span class="class">.logs</span>: /var/wwwlog/elasticsearch</span><br><span class="line">path<span class="class">.plugins</span>: /usr/local/elasticsearch/plugins</span><br><span class="line">network<span class="class">.host</span>: <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line">http<span class="class">.port</span>: <span class="number">9200</span></span><br><span class="line">bootstrap<span class="class">.mlockall</span>: true</span><br><span class="line">indices<span class="class">.fielddata</span><span class="class">.cache</span><span class="class">.size</span>: <span class="number">75%</span></span><br><span class="line">indices<span class="class">.breaker</span><span class="class">.fielddata</span><span class="class">.limit</span>: <span class="number">85%</span></span><br><span class="line">threadpool<span class="class">.search</span><span class="class">.queue_size</span>: <span class="number">10000</span></span><br><span class="line">discovery<span class="class">.zen</span><span class="class">.ping</span><span class="class">.multicast</span><span class="class">.enabled</span>: false</span><br><span class="line"></span><br><span class="line"><span class="id">#Cluster</span></span><br><span class="line"><span class="id">#node</span><span class="class">.name</span>: <span class="string">"master_node_10.0.6.6"</span></span><br><span class="line"><span class="id">#node</span><span class="class">.master</span>: true</span><br><span class="line"><span class="id">#node</span><span class="class">.data</span>: true</span><br><span class="line"><span class="id">#discovery</span><span class="class">.zen</span><span class="class">.ping</span><span class="class">.unicast</span><span class="class">.hosts</span>: [<span class="string">"10.0.6.5"</span>, <span class="string">"10.0.1.155"</span>]</span><br></pre></td></tr></table></figure>
<p>&emsp;根据自身机器内存情况调整JVM内存大小，原则上是越大越好但需要预留足够的内存给系统，此规则也是根据实际情况而定并非铁律。<br>&emsp;配置文件：<strong><code>/usr/local/elasticsearch/bin/elasticsearch.in.sh</code></strong><br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">ES_MIN_MEM=<span class="value"><span class="number">10</span>g</span></span></span><br><span class="line"><span class="setting">ES_MAX_MEM=<span class="value"><span class="number">10</span>g</span></span></span><br></pre></td></tr></table></figure></p>
<h3 id="启动_&amp;_停止"><strong>启动 &amp; 停止</strong></h3><h4 id="启动"><strong>启动</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; /usr/<span class="built_in">local</span>/elasticsearch/bin/elasticsearch <span class="operator">-d</span></span><br></pre></td></tr></table></figure>
<h4 id="停止"><strong>停止</strong></h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#停止本地节点</span></span><br><span class="line"><span class="variable">$&gt;</span> curl -<span class="constant">XPOST </span><span class="string">'http://localhost:9200/_cluster/nodes/_local/_shutdown'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#停止集群所有节点</span></span><br><span class="line"><span class="variable">$&gt;</span> curl -<span class="constant">XPOST </span><span class="string">'http://localhost:9200/_shutdown'</span></span><br></pre></td></tr></table></figure>
<h4 id="检验"><strong>检验</strong></h4><p>&emsp;启动Elasticsearch后访问<code>http://yourip:9200</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$&gt; <span class="regexp">/usr/</span>local<span class="regexp">/elasticsearch/</span>bin/elasticsearch -d</span><br><span class="line"></span><br><span class="line">$&gt; curl -XGET <span class="string">http:</span><span class="comment">//127.0.0.1:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"status"</span> : <span class="number">200</span>,</span><br><span class="line">  <span class="string">"name"</span> : <span class="string">"Vindaloo"</span>,</span><br><span class="line">  <span class="string">"cluster_name"</span> : <span class="string">"elasticsearch"</span>,</span><br><span class="line">  <span class="string">"version"</span> : &#123;</span><br><span class="line">    <span class="string">"number"</span> : <span class="string">"1.7.1"</span>,</span><br><span class="line">    <span class="string">"build_hash"</span> : <span class="string">"b88f43fc40b0bcd7f173a1f9ee2e97816de80b19"</span>,</span><br><span class="line">    <span class="string">"build_timestamp"</span> : <span class="string">"2015-07-29T09:54:16Z"</span>,</span><br><span class="line">    <span class="string">"build_snapshot"</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"lucene_version"</span> : <span class="string">"4.10.4"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"tagline"</span> : <span class="string">"You Know, for Search"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Kibana"><strong>Kibana</strong></h2><h3 id="安装-1"><strong>安装</strong></h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useradd kibana</span><br><span class="line">wget <span class="string">https:</span><span class="comment">//download.elastic.co/kibana/kibana/kibana-4.1.1-linux-x64.tar.gz</span></span><br><span class="line">tar -zxf kibana-<span class="number">4.1</span><span class="number">.1</span>-linux-x64.tar.gz</span><br><span class="line">mv kibana-<span class="number">4.1</span><span class="number">.1</span>-linux-x64 <span class="regexp">/usr/</span>local/kibana</span><br><span class="line">chown -R <span class="string">kibana:</span>kibana <span class="regexp">/usr/</span>local<span class="regexp">/kibana/</span></span><br></pre></td></tr></table></figure>
<h3 id="配置-1"><strong>配置</strong></h3><p>&emsp;配置文件<strong><code>/usr/local/kibana/config/kibana.yml</code></strong><br>&emsp;根据自身环境配置<strong><code>elasticsearch_url</code></strong>、<strong><code>host</code></strong>、<strong><code>port</code></strong>等参数</p>
<h4 id="Kibana启动控制脚本"><strong>Kibana启动控制脚本</strong></h4><p>&emsp;添加启动脚本<br>&emsp;启动Kibana<strong><code>/etc/init.d/kibana start</code></strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bin/sh</span></span><br><span class="line"><span class="comment"># Init script for kibana</span></span><br><span class="line"><span class="comment"># From Kibana package</span></span><br><span class="line"><span class="comment"># Generated by pleaserun.</span></span><br><span class="line"><span class="comment"># Implemented based on LSB Core 3.1:</span></span><br><span class="line"><span class="comment">#   * Sections: 20.2, 20.3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:          kibana</span></span><br><span class="line"><span class="comment"># Required-Start:    $remote_fs $syslog</span></span><br><span class="line"><span class="comment"># Required-Stop:     $remote_fs $syslog</span></span><br><span class="line"><span class="comment"># Default-Start:     2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:      0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description:</span></span><br><span class="line"><span class="comment"># Description:       no description given</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line">PATH=/sbin:/usr/sbin:/bin:/usr/bin</span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line"></span><br><span class="line">name=kibana</span><br><span class="line">program=/usr/<span class="built_in">local</span>/kibana/bin/kibana</span><br><span class="line">args=<span class="string">''</span></span><br><span class="line">pidfile=<span class="string">"/var/run/<span class="variable">$name</span>.pid"</span></span><br><span class="line">user=<span class="string">"kibana"</span></span><br><span class="line">group=<span class="string">"kibana"</span></span><br><span class="line"><span class="built_in">chdir</span>=<span class="string">"/"</span></span><br><span class="line">chroot=<span class="string">"/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">trace</span></span>() &#123;</span><br><span class="line">  logger -t <span class="string">"/etc/init.d/kibana"</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">emit</span></span>() &#123;</span><br><span class="line">  trace <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Ensure the log directory is setup correctly.</span></span><br><span class="line">  [ ! <span class="operator">-d</span> <span class="string">"/var/log/kibana/"</span> ] &amp;&amp; mkdir <span class="string">"/var/log/kibana/"</span></span><br><span class="line">  chown <span class="string">"<span class="variable">$user</span>"</span>:<span class="string">"<span class="variable">$group</span>"</span> <span class="string">"/var/log/kibana/"</span></span><br><span class="line">  chmod <span class="number">755</span> <span class="string">"/var/log/kibana/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Setup any environmental stuff beforehand</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Run the program!</span></span><br><span class="line"></span><br><span class="line">  chroot --userspec <span class="string">"<span class="variable">$user</span>"</span>:<span class="string">"<span class="variable">$group</span>"</span> <span class="string">"<span class="variable">$chroot</span>"</span> sh -c <span class="string">"</span><br><span class="line"></span><br><span class="line">    cd \"<span class="variable">$chdir</span>\"</span><br><span class="line">    exec \"<span class="variable">$program</span>\" <span class="variable">$args</span></span><br><span class="line">  "</span> &gt;&gt; /var/<span class="built_in">log</span>/kibana/kibana.stdout <span class="number">2</span>&gt;&gt; /var/<span class="built_in">log</span>/kibana/kibana.stderr &amp;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Generate the pidfile from here. If we instead made the forked process</span></span><br><span class="line">  <span class="comment"># generate it there will be a race condition between the pidfile writing</span></span><br><span class="line">  <span class="comment"># and a process possibly asking for status.</span></span><br><span class="line">  <span class="built_in">echo</span> $! &gt; <span class="variable">$pidfile</span></span><br><span class="line"></span><br><span class="line">  emit <span class="string">"<span class="variable">$name</span> started"</span></span><br><span class="line">  <span class="built_in">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">  <span class="comment"># Try a few times to kill TERM the program</span></span><br><span class="line">  <span class="keyword">if</span> status ; <span class="keyword">then</span></span><br><span class="line">    pid=$(cat <span class="string">"<span class="variable">$pidfile</span>"</span>)</span><br><span class="line">    trace <span class="string">"Killing <span class="variable">$name</span> (pid <span class="variable">$pid</span>) with SIGTERM"</span></span><br><span class="line">    <span class="built_in">kill</span> -TERM <span class="variable">$pid</span></span><br><span class="line">    <span class="comment"># Wait for it to exit.</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> ; <span class="keyword">do</span></span><br><span class="line">      trace <span class="string">"Waiting <span class="variable">$name</span> (pid <span class="variable">$pid</span>) to die..."</span></span><br><span class="line">      status || <span class="built_in">break</span></span><br><span class="line">      sleep <span class="number">1</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">if</span> status ; <span class="keyword">then</span></span><br><span class="line">      emit <span class="string">"<span class="variable">$name</span> stop failed; still running."</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      emit <span class="string">"<span class="variable">$name</span> stopped."</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">status</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="operator">-f</span> <span class="string">"<span class="variable">$pidfile</span>"</span> ] ; <span class="keyword">then</span></span><br><span class="line">    pid=$(cat <span class="string">"<span class="variable">$pidfile</span>"</span>)</span><br><span class="line">    <span class="keyword">if</span> ps -p <span class="variable">$pid</span> &gt; /dev/null <span class="number">2</span>&gt; /dev/null ; <span class="keyword">then</span></span><br><span class="line">      <span class="comment"># process by this pid is running.</span></span><br><span class="line">      <span class="comment"># It may not be our pid, but that's what you get with just pidfiles.</span></span><br><span class="line">      <span class="comment"># TODO(sissel): Check if this process seems to be the same as the one we</span></span><br><span class="line">      <span class="comment"># expect. It'd be nice to use flock here, but flock uses fork, not exec,</span></span><br><span class="line">      <span class="comment"># so it makes it quite awkward to use in this case.</span></span><br><span class="line">      <span class="built_in">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">return</span> <span class="number">2</span> <span class="comment"># program is dead but pid file exists</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">return</span> <span class="number">3</span> <span class="comment"># program is not running</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">force_stop</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> status ; <span class="keyword">then</span></span><br><span class="line">    stop</span><br><span class="line">    status &amp;&amp; <span class="built_in">kill</span> -KILL $(cat <span class="string">"<span class="variable">$pidfile</span>"</span>)</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">  force-start|start|stop|force-stop|restart)</span><br><span class="line">    trace <span class="string">"Attempting '<span class="variable">$1</span>' on kibana"</span></span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">  force-start)</span><br><span class="line">    PRESTART=no</span><br><span class="line">    <span class="built_in">exec</span> <span class="string">"<span class="variable">$0</span>"</span> start</span><br><span class="line">    ;;</span><br><span class="line">  start)</span><br><span class="line">    status</span><br><span class="line">    code=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$code</span> <span class="operator">-eq</span> <span class="number">0</span> ]; <span class="keyword">then</span></span><br><span class="line">      emit <span class="string">"<span class="variable">$name</span> is already running"</span></span><br><span class="line">      <span class="built_in">exit</span> <span class="variable">$code</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      start</span><br><span class="line">      <span class="built_in">exit</span> $?</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    ;;</span><br><span class="line">  stop) stop ;;</span><br><span class="line">  force-stop) force_stop ;;</span><br><span class="line">  status)</span><br><span class="line">    status</span><br><span class="line">    code=$?</span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$code</span> <span class="operator">-eq</span> <span class="number">0</span> ] ; <span class="keyword">then</span></span><br><span class="line">      emit <span class="string">"<span class="variable">$name</span> is running"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      emit <span class="string">"<span class="variable">$name</span> is not running"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="variable">$code</span></span><br><span class="line">    ;;</span><br><span class="line">  restart)</span><br><span class="line"></span><br><span class="line">    stop &amp;&amp; start</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$SCRIPTNAME</span> &#123;start|force-start|stop|force-start|force-stop|status|restart&#125;"</span> &gt;&amp;<span class="number">2</span></span><br><span class="line">    <span class="built_in">exit</span> <span class="number">3</span></span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> $?</span><br></pre></td></tr></table></figure></p>
<h4 id="Nginx配置"><strong>Nginx配置</strong></h4><p>&emsp;配置文件<strong><code>kibana.conf</code></strong><br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$&gt; yum -y install httpd-tools</span><br><span class="line">$&gt; htpasswd -c /usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/kibana.users mogl</span><br><span class="line"></span><br><span class="line">upstream kibana &#123;</span><br><span class="line">        server 127.0.0.1:5601;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">        listen                     80;</span><br><span class="line">        server_name                moglkibana.com;</span><br><span class="line">        access_log                 /<span class="keyword">var</span>/wwwlog/kibana/access.<span class="keyword">log</span> main;</span><br><span class="line">        error_log                  /<span class="keyword">var</span>/wwwlog/kibana/<span class="keyword">error</span>.<span class="keyword">log</span>  <span class="keyword">error</span>;</span><br><span class="line"></span><br><span class="line">		auth_basic <span class="string">"Kibana Access"</span>;</span><br><span class="line">		auth_basic_user_file /usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/kibana.users;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_next_upstream http_500 http_502 http_504 <span class="keyword">error</span> timeout invalid_header;</span><br><span class="line">            proxy_pass                  http:<span class="comment">//kibana;</span></span><br><span class="line">            proxy_set_header            Host             <span class="label">$host</span>;</span><br><span class="line">            proxy_set_header            X-Real-IP        <span class="label">$remote_addr</span>;</span><br><span class="line">            proxy_set_header            X-Forwarded-<span class="keyword">For</span>  <span class="label">$proxy_add_x_forwarded_for</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Logstash"><strong>Logstash</strong></h2><h4 id="Logstash_服务端安装配置"><strong>Logstash 服务端安装配置</strong></h4><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&gt;</span> wget <span class="symbol">https:</span>/<span class="regexp">/download.elastic.co/logstash</span><span class="regexp">/logstash/packages</span><span class="regexp">/centos/logstash</span>-<span class="number">1.5</span>.<span class="number">4</span>-<span class="number">1</span>.noarch.rpm</span><br><span class="line"><span class="variable">$&gt;</span> yum localinstall /home/logstash-<span class="number">1.5</span>.<span class="number">4</span>-<span class="number">1</span>.noarch.rpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置SSL、FQDN</span></span><br><span class="line"><span class="variable">$&gt;</span> cd /etc/pki/tls</span><br><span class="line"><span class="variable">$&gt;</span> openssl req -subj <span class="string">'/CN=elk.mogl.com/'</span> -x509 -days <span class="number">3650</span> -batch -nodes -newkey <span class="symbol">rsa:</span><span class="number">2048</span> -keyout private/logstash-forwarder.key -out certs/logstash-forwarder.crt</span><br></pre></td></tr></table></figure>
<p>&emsp;创建logstash配置文件<br><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/logstash/conf.d/<span class="number">01</span>-logstash-initial.conf &lt;&lt; <span class="type">EOF</span></span><br><span class="line">input &#123;</span><br><span class="line">  lumberjack &#123;</span><br><span class="line">    port =&gt; <span class="number">5043</span></span><br><span class="line">    <span class="keyword">type</span> =&gt; <span class="string">"logs"</span></span><br><span class="line">    ssl_certificate =&gt; <span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span></span><br><span class="line">    ssl_key =&gt; <span class="string">"/etc/pki/tls/private/logstash-forwarder.key"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  <span class="keyword">if</span> [<span class="keyword">type</span>] == <span class="string">"syslog"</span> &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">      <span class="keyword">match</span> =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;SYSLOGTIMESTAMP:syslog_timestamp&#125; %&#123;SYSLOGHOST:syslog_hostname&#125; %&#123;DATA:syslog_program&#125;(?:\[%&#123;POSINT:syslog_pid&#125;\])?: %&#123;GREEDYDATA:syslog_message&#125;"</span> &#125;</span><br><span class="line">      add_field =&gt; [ <span class="string">"received_at"</span>, <span class="string">"%&#123;@timestamp&#125;"</span> ]</span><br><span class="line">      add_field =&gt; [ <span class="string">"received_from"</span>, <span class="string">"%&#123;host&#125;"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">    syslog_pri &#123; &#125;</span><br><span class="line">    date &#123;</span><br><span class="line">      <span class="keyword">match</span> =&gt; [ <span class="string">"syslog_timestamp"</span>, <span class="string">"MMM  d HH:mm:ss"</span>, <span class="string">"MMM dd HH:mm:ss"</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123; host =&gt; localhost &#125;</span><br><span class="line">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">EOF</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;<code>output</code>中的<code>elasticsearch</code>配置<code>host</code>若配置成<strong><code>[&quot;localhost:9200&quot;]</code></strong>则在与elasticsearchl连接时会报错<strong><code>Caught exception while handling client http traffic, closing connection</code></strong></p>
<h4 id="Logstash_客户端安装配置"><strong>Logstash 客户端安装配置</strong></h4><p>&emsp;安装logstash-forward并复制ssl证书<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&gt; wget <span class="string">https:</span><span class="comment">//download.elastic.co/logstash-forwarder/binaries/logstash-forwarder-0.4.0-1.x86_64.rpm</span></span><br><span class="line">$&gt; yum localinstall logstash-forwarder-<span class="number">0.4</span><span class="number">.0</span>-<span class="number">1.</span>x86_64.rpm</span><br><span class="line">$&gt; echo <span class="string">'10.0.6.6 elk.mogl.com'</span> &gt;&gt; <span class="regexp">/etc/</span>hosts</span><br><span class="line">$&gt; scp root<span class="annotation">@elk</span>.mogl.<span class="string">com:</span><span class="regexp">/etc/</span>pki<span class="regexp">/tls/</span>certs<span class="regexp">/logstash-forwarder.crt /</span>etc<span class="regexp">/pki/</span>tls<span class="regexp">/certs/</span>logstash-forwarder.crt</span><br></pre></td></tr></table></figure></p>
<p>&emsp;logstash-forward客户端转发配置<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$&gt; mv <span class="regexp">/etc/</span>logstash-forwarder.conf <span class="regexp">/etc/</span>logstash-forwarder.conf.org</span><br><span class="line"></span><br><span class="line">cat &gt; <span class="regexp">/etc/</span>logstash-forwarder.conf &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"network"</span>: &#123;</span><br><span class="line">    <span class="string">"servers"</span>: [ <span class="string">"elk.mogl.com:5043"</span> ],</span><br><span class="line"></span><br><span class="line">    <span class="string">"ssl ca"</span>: <span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"timeout"</span>: <span class="number">15</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">"files"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"paths"</span>: [</span><br><span class="line">        <span class="string">"/var/log/messages"</span>,</span><br><span class="line">        <span class="string">"/var/log/secure"</span></span><br><span class="line">      ],</span><br><span class="line"></span><br><span class="line">      <span class="string">"fields"</span>: &#123; <span class="string">"type"</span>: <span class="string">"syslog"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$&gt; <span class="regexp">/etc/i</span>nit.d<span class="regexp">/logstash-forwarder start</span></span><br></pre></td></tr></table></figure></p>
<h4 id="创建索引模式"><strong>创建索引模式</strong></h4><p>&emsp;访问Kibana，在<strong><code>setting</code></strong>中添加索引即可。</p>
<h2 id="采集分析Nginx日志"><strong>采集分析Nginx日志</strong></h2><h4 id="Server端"><strong>Server端</strong></h4><p>&emsp;添加pattern匹配规则<br>&emsp;我所使用的Nginx日志格式<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">log_format</span> main <span class="string">'<span class="variable">$remote_addr</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">                         <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">                         <span class="string">'"<span class="variable">$http_user_agent</span>" <span class="variable">$http_x_forwarded_for</span> <span class="variable">$request_length</span> <span class="variable">$request_time</span> <span class="variable">$upstream_addr</span> <span class="variable">$host</span>'</span>;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;规则可通过此网站进行测试<a href="https://grokdebug.herokuapp.com/" target="_blank" rel="external">Logstash匹配测试网站</a><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$&gt; mkdir <span class="regexp">/opt/</span>logstash/patterns</span><br><span class="line"></span><br><span class="line">cat &gt; <span class="regexp">/opt/</span>logstash<span class="regexp">/patterns/</span>nginx &lt;&lt; EOF</span><br><span class="line">NGUSERNAME [a-zA-Z\.\@\-\+_%]+</span><br><span class="line">NGUSER %&#123;NGUSERNAME&#125;</span><br><span class="line">NGINXACCESS %&#123;<span class="string">IPORHOST:</span>remote_addr&#125; \[%&#123;<span class="string">HTTPDATE:</span>time_local&#125;\] <span class="string">"%&#123;WORD:method&#125; %&#123;URIPATH:path&#125;(?:%&#123;URIPARAM:param&#125;)? HTTP/%&#123;NUMBER:httpversion&#125;"</span> %&#123;<span class="string">INT:</span>status&#125; %&#123;<span class="string">INT:</span>body_bytes_sent&#125; %&#123;<span class="string">QS:</span>http_referer&#125; %&#123;<span class="string">QS:</span>http_user_agent&#125; %&#123;<span class="string">NOTSPACE:</span>http_x_forwarded_for&#125; %&#123;<span class="string">INT:</span>request_length&#125; %&#123;<span class="string">NUMBER:</span>request_time&#125; %&#123;<span class="string">NOTSPACE:</span>upstream_addr&#125; %&#123;<span class="string">IPORHOST:</span>host&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$&gt; chown -R <span class="string">logstash:</span>logstash <span class="regexp">/opt/</span>logstash<span class="regexp">/patterns/</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;Logstash添加Nginx相关配置<code>/etc/logstash/conf.d/logstash-nginx.conf</code><br>&emsp;如果按照上文logstash配置了统计syslog的采集，端口需要改变，否则会报错地址已被占用<br><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  lumberjack &#123;</span><br><span class="line">    port =&gt; <span class="number">5043</span></span><br><span class="line">    <span class="keyword">type</span> =&gt; <span class="string">"logs"</span></span><br><span class="line">    ssl_certificate =&gt; <span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span></span><br><span class="line">    ssl_key =&gt; <span class="string">"/etc/pki/tls/private/logstash-forwarder.key"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filter &#123;</span><br><span class="line">  <span class="keyword">if</span> [<span class="keyword">type</span>] == <span class="string">"nginx"</span> &#123;</span><br><span class="line">          grok &#123;</span><br><span class="line">                  <span class="keyword">match</span> =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;NGINXACCESS&#125;"</span> &#125;</span><br><span class="line">          &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123; host =&gt; localhost &#125;</span><br><span class="line">  stdout &#123; codec =&gt; rubydebug &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Client端"><strong>Client端</strong></h4><p>&emsp;logstash-forward将日志转发到服务端<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">network</span>": <span class="value">&#123;</span><br><span class="line">    "<span class="attribute">servers</span>": <span class="value">[ <span class="string">"elk.mogl.com:5043"</span> ]</span>,</span><br><span class="line"></span><br><span class="line">    "<span class="attribute">ssl ca</span>": <span class="value"><span class="string">"/etc/pki/tls/certs/logstash-forwarder.crt"</span></span>,</span><br><span class="line"></span><br><span class="line">    "<span class="attribute">timeout</span>": <span class="value"><span class="number">15</span></span><br><span class="line">  </span>&#125;</span>,</span><br><span class="line"></span><br><span class="line">  "<span class="attribute">files</span>": <span class="value">[</span><br><span class="line">    &#123;</span><br><span class="line">        "<span class="attribute">paths</span>": <span class="value">[</span><br><span class="line">            <span class="string">"/var/wwwlog/test/access.log"</span></span><br><span class="line">        ]</span>,</span><br><span class="line"></span><br><span class="line">        "<span class="attribute">fields</span>": <span class="value">&#123; "<span class="attribute">type</span>": <span class="value"><span class="string">"nginx"</span> </span>&#125;</span><br><span class="line">    </span>&#125;</span><br><span class="line">  ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></p>

				</div>

				

					<div class="content-tag">

						 <a class="tag-link" href="/tags/EFK-ELK/">EFK/ELK</a>

					</div>

				

			</article>

			<div class="content-nav">

				
					<a href="/2015/12/28/EFK/" title="EFK日志系统——Fluentd代替Logstash & GeoIP世界地图">&larr; Prev</a>
				

				
					<a href="/2015/12/20/fluentd/" title="Fluentd日志收集">Next &rarr;</a>
				

			</div>

		</div>


	</div>

	<div class="row">
	<p class="theme">Powered: <a href="http://hexo.io/"  target="_blank">Hexo</a>, Theme: <a href="https://github.com/samwhelp/hexo-theme-nadya" target="_blank">Nadya</a> remastered from <a href="https://github.com/nadymain/hexo-theme-nadymain" target="_blank">NadyMain</a></p>
</div>

	<!-- <div class="row">
	<p class="theme">Powered: <a href="http://hexo.io/"  target="_blank">Hexo</a>, Theme: <a href="https://github.com/samwhelp/hexo-theme-nadya" target="_blank">Nadya</a> remastered from <a href="https://github.com/nadymain/hexo-theme-nadymain" target="_blank">NadyMain</a></p>
</div>
 -->

</body>
</html>
