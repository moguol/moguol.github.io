<!DOCTYPE html>
<html lang="zh-Hant-TW">

	

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title> 墨 痕 </title>
	<meta property="og:title" content=" Django Book笔记 | Hexo " />
	<meta name="twitter:title" content=" Django Book笔记 | Hexo ">

	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary">

	<meta name="description" content=" Django Book笔记 | Hexo ">
	<meta property="og:description" content=" Django Book笔记 | Hexo " />
	<meta name="twitter:description" content=" Django Book笔记 | Hexo " />

	<link rel="icon" type="image/x-icon" href="http://yoursite.com/asset/img/favicon.png">

	<link rel="image_src" href="http://yoursite.com/asset/img/logo.png" >
	<meta property="og:image" content="http://yoursite.com/asset/img/logo.png" />

	
	<link href="http://yoursite.com/atom.xml" title="Hexo" type="application/atom+xml" rel="alternative">
	

	<link rel="canonical" href="/2015/11/15/Django-Book/index.html">

	<link rel="stylesheet" href="/asset/css/main.css">

</head>


<body>

	
	<header class="site-header">

		
		<nav class="nav-page">

			<div class="row">

				<ul>

					

					<li><a href="/">Home</a></li>

					

					<li><a href="/archives">Sitemap</a></li>

					

					<li><a href="/atom.xml">Rss</a></li>

					

				</ul>

			</div>

		</nav>


		<div class="site-header-main">

			<div class="row">

				<h1><a href="/">墨 痕</a></h1>
				<h6><a href="/">fatesai#gmail.com</a></h6>

				

			</div>

		</div>

		


		<nav class="nav-cat">

			<div class="row">

				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Bigdata/">Bigdata</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OPS/">OPS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a></li></ul>

			</div>

		</nav>




	</header>


	<div id="content" class="site-content">

		
		<div class="row content-post">
			<article itemscope itemtype="http://schema.org/Article">

				

				

				<p class="content-meta">
					<span class="meta-date" itemprop="datePublished" content="2015-11-15">2015-11-15</span>

					
					  <span class="meta-cat">
						<a class="category-link" href="/categories/Python/">Python</a>
					  </span>
					
				</p>

				

					<h2 class="content-title">
						<a href="/2015/11/15/Django-Book/" itemprop="url"><span itemprop="name">Django Book笔记</span></a>
					</h2>

				


				<div class="content" itemprop="articleBody">
					<p>&emsp;最近在整理之前的笔记，这是之前自学Django时记录的，梳理以备查阅。教程看的是<a href="http://djangobook.py3k.cn/2.0/" target="_blank" rel="external">The Django Book中文版</a></p>
<h2 id="安装"><strong>安装</strong></h2><p>&emsp;基本环境</p>
<ul>
<li>Ubuntu14.04 LTS</li>
<li>Django1.7.1</li>
<li>Python2.7.6</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; pip <span class="keyword">install</span> Django==<span class="number">1.7</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="开始项目"><strong>开始项目</strong></h2><h3 id="创建项目"><strong>创建项目</strong></h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$&gt; django-admin<span class="class">.py</span> startproject <span class="function"><span class="title">mysite</span><span class="params">(项目名)</span></span>  </span><br><span class="line"></span><br><span class="line">新建目录结构</span><br><span class="line"> mysite/</span><br><span class="line">	 manage<span class="class">.py</span></span><br><span class="line">	 mysite/</span><br><span class="line">		 __init__<span class="class">.py</span></span><br><span class="line">		 settings<span class="class">.py</span></span><br><span class="line">		 urls<span class="class">.py</span></span><br><span class="line">		 wsgi.py</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><strong>init</strong>.py</strong> ：让 Python 把该目录当成一个开发包 (即一组模块)所需的文件。 这是一个空文件，一般你不需要修改它。</li>
<li><strong>manage.py</strong> ：一种命令行工具，允许你以多种方式与该 Django 项目进行交互。 键入python manage.py help，看一下它能做什么。 你应当不需要编辑这个文件；在这个目录下生成它纯是为了方便</li>
<li><p><strong>settings.py</strong> ：该 Django 项目的设置或配置。 查看并理解这个文件中可用的设置类型及其默认值。</p>
  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改配置项：</span></span><br><span class="line">  <span class="title">LANGUAGE_CODE</span> = <span class="string">'zh-cn'</span></span><br><span class="line">  TIME_ZONE = <span class="string">'Asia/Shanghai'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>urls.py</strong>：Django项目的URL设置。 可视其为你的django网站的目录。 目前，它是空的。</p>
</li>
<li><strong>wsgi.py</strong>：Django工程入口</li>
</ul>
<h3 id="启动开发Web服务器"><strong>启动开发Web服务器</strong></h3><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首次启动先执行</span></span><br><span class="line"><span class="variable">$&gt;</span> python manage.py migrate</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动Web服务器</span></span><br><span class="line"><span class="variable">$&gt;</span> python manage.py runserver <span class="symbol">ip:</span>port</span><br></pre></td></tr></table></figure>
<h2 id="视图——View_&amp;_URLconf"><strong>视图——View &amp; URLconf</strong></h2><h3 id="视图"><strong>视图</strong></h3><p>&emsp;创建视图文件：<strong><code>mysite/mysite/views.py</code></strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="comment">#视图函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></span><br><span class="line">  <span class="keyword">return</span> HttpResponse(<span class="string">"Hello world"</span>)</span><br></pre></td></tr></table></figure></p>
<p>&emsp;每个视图函数至少要有一个参数，通常被叫作request。 这是一个触发这个视图、包含当前Web请求信息的对象，是类django.http.HttpRequest的一个实例。在这个示例中，我们虽然不用request做任何事情，然而它仍必须是这个视图的第一个参数。</p>
<h3 id="URLconf"><strong>URLconf</strong></h3><p>&emsp;URLconf是为了绑定视图函数和URL，当使用<code>django-admin.py startproject</code>创建项目时，该脚本会自动创建一份 URLconf(即<strong><code>urls.py</code></strong>)<br>&emsp;在添加URLconf前，需要告知Django URLconf的根目录路径。<strong><code>mysite/settings.py</code></strong>中添加<strong><code>ROOT_URLCONF = &#39;mysite.urls&#39;</code></strong><br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls.defaults <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> mysite.views <span class="keyword">import</span> hello               #<span class="keyword">import</span>视图函数</span><br><span class="line"></span><br><span class="line">urlpatterns = patterns(<span class="string">''</span>,</span><br><span class="line">	(<span class="string">'^hello/$'</span>, hello),</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h3 id="Django处理请求过程"><strong>Django处理请求过程</strong></h3><ul>
<li>进来的请求转入/hello/</li>
<li>Django通过mysite/settings.py里的ROOT_URLCONF配置来决定根URLconf.</li>
<li>Django在URLconf中的所有URL模式中，查找第一个匹配/hello/的条目。</li>
<li>如果找到匹配，将调用相应的视图函数(mysite/views.py里的函数)</li>
<li>视图函数返回一个HttpResponse</li>
<li>Django转换HttpResponse为一个适合的HTTP response， 以Web page显示出来(带有HTTP头和body的Web Response)</li>
</ul>
<h2 id="模板——template"><strong>模板——template</strong></h2><p>&emsp;模板是Django中页面展示部分，包含HTML/CSS/JS等内容。<br>&emsp;在<strong><code>mysite/settings.py</code></strong>中指定模板路径<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">BASE_DIR = os<span class="class">.path</span><span class="class">.dirname</span>(os<span class="class">.path</span><span class="class">.dirname</span>(__file__))</span><br><span class="line">TEMPLATE_DIRS = (</span><br><span class="line">	os<span class="class">.path</span><span class="class">.join</span>(BASE_DIR, <span class="string">'templates'</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h3 id="完整Django开发流程"><strong>完整Django开发流程</strong></h3><ul>
<li><p>编写模板文件<br>  &emsp;在项目文件夹下创建模板文件夹：<strong><code>mysite/templates</code></strong></p>
  <figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	It is now </span><span class="expression">&#123;&#123;<span class="variable">nowTime</span>&#125;&#125;</span><span class="xml">.</span><br><span class="line"> <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建视图函数<br>  &emsp;在<strong><code>mysite/views.py</code></strong>中创建视图函数。此为最基础的方法</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django<span class="class">.template</span><span class="class">.loader</span> import get_template</span><br><span class="line">from django<span class="class">.template</span> import Context</span><br><span class="line"></span><br><span class="line">def <span class="function"><span class="title">hourTemplate</span><span class="params">(request)</span></span>:</span><br><span class="line">   now = datetime<span class="class">.datetime</span><span class="class">.now</span>()</span><br><span class="line">   temp = <span class="function"><span class="title">get_template</span><span class="params">(<span class="string">'hourTemplate.html'</span>)</span></span>     #创建template对象</span><br><span class="line">   <span class="tag">html</span> = temp.<span class="function"><span class="title">render</span><span class="params">(Context(&#123;<span class="string">'nowTime'</span>: now&#125;)</span></span>)     #创建Context和调用<span class="function"><span class="title">render</span><span class="params">()</span></span>方法</span><br><span class="line">   return <span class="function"><span class="title">HttpResponse</span><span class="params">(html)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>快捷调用模板：render_to_response<br> &emsp;在视图函数中可以使用快捷调用模板的函数<strong>render_to_response</strong>，此方法较为常用。</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">hourTemplate</span><span class="params">(request)</span>:</span></span><br><span class="line">           now = datetime.datetime.now()</span><br><span class="line">           <span class="keyword">return</span> render_to_response(<span class="string">'hourTemplate.html'</span>, &#123;<span class="string">'nowTime'</span>: now&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置URL<br>  &emsp;在<strong><code>mysite/urls.py</code></strong>中添加URLconf</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysite.views <span class="keyword">import</span> hourTemplate</span><br><span class="line">   urlpatterns = patterns(</span><br><span class="line">		<span class="string">''</span>,</span><br><span class="line">		(<span class="string">r'^hourTemplate/$'</span>, hourTemplate),</span><br><span class="line">   ）</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="模板继承"><strong>模板继承</strong></h3><p>&emsp;模板还能使用<strong>标签</strong>(<code>if/else</code>、<code>for</code>、<code>ifequal/ifnotequal</code>)，具体详见<a href="http://djangobook.py3k.cn/2.0/chapter04/" target="_blank" rel="external">The Django Book 第四章</a><br>&emsp;模板还有一个非常重要的功能：<strong>模板继承</strong>，为了减少共用页面所引起的重复和冗余代码，Django解决此问题的首选方法是使用模板继承。下面通过一个实例加以说明。<br>&emsp;模板目录下有三个模板文件<strong><code>templates/base.html、now.html、later.html</code></strong></p>
<ul>
<li><p>base.html——基础模板，每个<code>block name</code>必须唯一</p>
  <figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"content-type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">title</span>&gt;</span></span><span class="template_tag">&#123;% <span class="keyword">block</span> title %&#125;</span><span class="xml"></span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">div</span> <span class="attribute">align</span>=<span class="value">'center'</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">h1</span> <span class="attribute">id</span>=<span class="value">"content1"</span>&gt;</span>Template Inherit<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">                </span><span class="template_tag">&#123;% <span class="keyword">block</span> content %&#125;</span><span class="xml"></span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"></span><br><span class="line">                </span><span class="template_tag">&#123;% <span class="keyword">block</span> footer %&#125;</span><span class="xml"></span><br><span class="line">                    <span class="tag">&lt;<span class="title">hr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="title">p</span>&gt;</span>Thank for visitting my website<span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line">                </span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"></span><br><span class="line">            <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>now.html</p>
  <figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template_tag">&#123;% <span class="keyword">extends</span> 'base.html' %&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><span class="template_tag">&#123;% <span class="keyword">block</span> title %&#125;</span><span class="xml">This is now.html</span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template_tag">&#123;% <span class="keyword">block</span> content %&#125;</span><span class="xml"></span><br><span class="line">	<span class="tag">&lt;<span class="title">p</span>&gt;</span>Now time is </span><span class="variable">&#123;&#123; nowTime &#125;&#125;</span><span class="xml"> <span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"></span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>later.html</p>
  <figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"></span><span class="template_tag">&#123;% <span class="keyword">extends</span> 'base.html' %&#125;</span><span class="xml"></span><br><span class="line"></span><br><span class="line"></span><span class="template_tag">&#123;% <span class="keyword">block</span> title %&#125;</span><span class="xml">This is later.html</span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"></span><br><span class="line"></span><span class="template_tag">&#123;% <span class="keyword">block</span> content %&#125;</span><span class="xml"></span><br><span class="line">	<span class="tag">&lt;<span class="title">p</span>&gt;</span>In </span><span class="variable">&#123;&#123; hours &#125;&#125;</span><span class="xml"> hour(s) later, it will be </span><span class="variable">&#123;&#123; laterTime &#125;&#125;</span><span class="xml"> <span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"></span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>视图函数——mysite/views.py</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> Http404</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">now</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="string">"""template inherit now"""</span></span><br><span class="line">now = datetime.datetime.now()</span><br><span class="line"><span class="keyword">return</span> render_to_response(<span class="string">'now.html'</span>, &#123;<span class="string">'nowTime'</span>: now&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">later</span><span class="params">(request, hourNum)</span>:</span></span><br><span class="line"><span class="string">"""template inherit later"""</span></span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">	hours = int(hourNum)</span><br><span class="line"><span class="keyword">except</span> Exception, e:</span><br><span class="line">	<span class="keyword">return</span> Http404, e</span><br><span class="line">hourLater = datetime.datetime.now() + datetime.timedelta(hours=hours)</span><br><span class="line"><span class="keyword">return</span> render_to_response(<span class="string">'later.html'</span>, &#123;<span class="string">'hours'</span>: hours, <span class="string">'laterTime'</span>: hourLater&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>URLconf配置</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = patterns(<span class="string">''</span>, </span><br><span class="line">		url(<span class="string">r'^now/$'</span>, now),</span><br><span class="line">		url(<span class="string">r'^later/(\d&#123;1,2&#125;)/$'</span>, later),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="模型"><strong>模型</strong></h2><p>&emsp;Django若需要与数据库交互则使用<strong>模型Model</strong>。模型负责数据库层面，app才可使用模型，project不行，所以需要先创建app。</p>
<h3 id="创建app"><strong>创建app</strong></h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$&gt; python manage<span class="class">.py</span> startapp appname</span><br><span class="line"></span><br><span class="line">app目录结构：</span><br><span class="line">	books/</span><br><span class="line">		 models<span class="class">.py</span></span><br><span class="line">		 migrations/</span><br><span class="line">			__init__<span class="class">.py</span></span><br><span class="line">		 views<span class="class">.py</span></span><br><span class="line">		 admin<span class="class">.py</span></span><br><span class="line">		 __init__<span class="class">.py</span></span><br><span class="line">		 tests.py</span><br></pre></td></tr></table></figure>
<h3 id="Django配置MySQL数据库"><strong>Django配置MySQL数据库</strong></h3><p>&emsp;<strong><code>mysite/setting.py</code></strong>(<code>NAME</code>中的数据库需要预先创建)<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123; </span><br><span class="line">	<span class="string">'default'</span>: &#123;</span><br><span class="line">		<span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">		<span class="string">'NAME'</span>: <span class="string">'books'</span>,</span><br><span class="line">		<span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">		<span class="string">'PASSWORD'</span>: <span class="string">'moguoliang'</span>,</span><br><span class="line">		<span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">		<span class="string">'PORT'</span>: <span class="string">'3306'</span>,</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;测试Django连接数据库<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt; python manage<span class="class">.py</span> shell</span><br><span class="line">from django<span class="class">.db</span> import connection</span><br><span class="line"><span class="attribute">cursor</span> = connection.<span class="function"><span class="title">cursor</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure></p>
<h3 id="编写数据库模型"><strong>编写数据库模型</strong></h3><p>&emsp;<strong><code>mysite/books/models.py</code></strong><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from django<span class="class">.db</span> import models</span><br><span class="line"></span><br><span class="line">class <span class="function"><span class="title">Publisher</span><span class="params">(models.Model)</span></span>:</span><br><span class="line">    name = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">30</span>)</span></span></span><br><span class="line">    <span class="tag">address</span> = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">50</span>)</span></span></span><br><span class="line">    city = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">60</span>)</span></span></span><br><span class="line">    state_province = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">30</span>)</span></span></span><br><span class="line">    country = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">30</span>)</span></span></span><br><span class="line">    website = models.<span class="function"><span class="title">URLField</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class <span class="function"><span class="title">Author</span><span class="params">(models.Model)</span></span>:</span><br><span class="line">    firstName = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">30</span>)</span></span></span><br><span class="line">    lastName = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">40</span>)</span></span></span><br><span class="line">    email = models.<span class="function"><span class="title">EmailField</span><span class="params">(blank=True,verbose_name=<span class="string">'e-mail'</span>)</span></span>	#允许空白</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class <span class="function"><span class="title">Book</span><span class="params">(models.Model)</span></span>:</span><br><span class="line">    title = models.<span class="function"><span class="title">CharField</span><span class="params">(max_length=<span class="number">100</span>)</span></span></span><br><span class="line">    authors = models.<span class="function"><span class="title">ManyToManyField</span><span class="params">(Author)</span></span></span><br><span class="line">    publisher = models.<span class="function"><span class="title">ForeignKey</span><span class="params">(Publisher)</span></span></span><br><span class="line">    publicationDate = models.<span class="function"><span class="title">DateField</span><span class="params">(blank=Ture, null=True)</span></span></span><br></pre></td></tr></table></figure></p>
<h3 id="安装&amp;测试模型"><strong>安装&amp;测试模型</strong></h3><h4 id="安装模型"><strong>安装模型</strong></h4><p>&emsp;<strong><code>mysite/setting.py</code></strong><br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">INSTALLED_APPS</span> = (</span><br><span class="line">   <span class="string">'books'</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h4 id="检查模型有效性"><strong>检查模型有效性</strong></h4><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt; python manage.py<span class="instruction"> check </span>       </span><br><span class="line"></span><br><span class="line"><span class="comment">#python manage.py validate     #旧版本</span></span><br></pre></td></tr></table></figure>
<h3 id="执行模型"><strong>执行模型</strong></h3><p>&emsp;<strong><code>models.py</code></strong>变更后都要执行<strong><code>makemigrations</code></strong>和<strong><code>migrate</code></strong>，<strong><code>sqlmigrate</code></strong>仅用来查看SQL语句<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 生成migrate</span></span><br><span class="line">$&gt; python manage.py makemigrations books </span><br><span class="line"><span class="preprocessor">#查看SQL语句</span></span><br><span class="line">$&gt; python manage.py sqlmigrate books <span class="number">0001</span> </span><br><span class="line"><span class="preprocessor">#执行SQL语句</span></span><br><span class="line">$&gt; python manage.py migrate</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#python manage.py syncdb     #旧版本</span></span><br></pre></td></tr></table></figure></p>
<h3 id="插入数据"><strong>插入数据</strong></h3><p>&emsp;使用Django提供的Python Shell进行插入数据测试。插入数据有两种方法：1. 逐条插入数据；2. 批量插入数据</p>
<ul>
<li><p>逐条插入</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&gt; python manage<span class="class">.py</span> shell</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from book<span class="class">.models</span> import Publisher</span><br><span class="line">&gt;&gt;&gt; p1 = <span class="function"><span class="title">Publisher</span><span class="params">(name=<span class="string">'test'</span>, address=<span class="string">'GaoXinYuan'</span>, city=<span class="string">'Shenzhen'</span>, state_province=<span class="string">'Guangdong'</span>, country=<span class="string">'China'</span>, website=<span class="string">'http://10.0.2.15:8000'</span>)</span></span></span><br><span class="line">&gt;&gt;&gt; p1.<span class="function"><span class="title">save</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>批量插入——objects.create()</p>
  <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&gt; python manage.py shell</span><br><span class="line">&gt;&gt;&gt; from book.models import Publisher</span><br><span class="line">&gt;&gt;&gt; p1 = Publisher.objects.create(name=<span class="string">'Apress'</span>, <span class="keyword">...</span> address=<span class="string">'2855 Telegraph Avenue'</span>, <span class="keyword">...</span> city=<span class="string">'Berkeley'</span>, state_province=<span class="string">'CA'</span>, country=<span class="string">'U.S.A.'</span>, <span class="keyword">...</span> website=<span class="string">'http://www.apress.com/'</span>)</span><br><span class="line">&gt;&gt;&gt; p2 = Publisher.objects.create(name=<span class="string">"O'Reilly"</span>, <span class="keyword">...</span> address=<span class="string">'10 Fawcett St.'</span>, city=<span class="string">'Cambridge'</span>, <span class="keyword">...</span> state_province=<span class="string">'MA'</span>, country=<span class="string">'U.S.A.'</span>, <span class="keyword">...</span> website=<span class="string">'http://www.oreilly.com/'</span>)</span><br><span class="line">&gt;&gt;&gt; publisher_list = Publisher.objects.all()</span><br><span class="line">&gt;&gt;&gt; publisher_list</span><br></pre></td></tr></table></figure>
</li>
<li><p>操作数据库的常用函数方法</p>
<ul>
<li>Plulisher.objects.create()           插入数据</li>
<li>Publisher.objects.all()                 显示所有数据</li>
<li>Publisher.objects.filter(name=’Apress’)     过滤显示数据</li>
<li>Publisher.objects.get(name=”Apress”)        获取单个对象</li>
<li>Publisher.objects.order_by(“name”)          数据排序</li>
<li>Publisher.objects.order_by(“-name”)         逆向数据排序</li>
<li>Publisher.objects.filter(country=”U.S.A.”).order_by(“-name”) 连锁查询</li>
<li>Publisher.objects.order_by(‘name’)[0]       限制返回数据(limit 1)</li>
<li>Publisher.objects.filter(id=52).update(name=’Apress Publishing’) 更新数据</li>
<li>Publisher.objects.filter(country=’USA’).delete()     删除数据</li>
</ul>
</li>
</ul>
<h2 id="Django_admin管理站点"><strong>Django admin管理站点</strong></h2><ul>
<li><p>创建管理员用户</p>
  <figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&gt;</span> <span class="keyword">python</span> manage.py createsuperuser</span><br></pre></td></tr></table></figure>
</li>
<li><p>重置superuser密码</p>
  <figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&gt;</span> <span class="keyword">python</span> manage.py changepassword username</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查<strong><code>mysite/urls.py</code></strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r'^admin/'</span>, include(admin.site.urls)),</span><br></pre></td></tr></table></figure>
</li>
<li><p>将模型model添加进admin管理——<strong><code>mysite/book/admin.py</code></strong></p>
  <figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib import admin</span><br><span class="line"><span class="keyword">from</span> book.models import Publisher, Author, Book</span><br><span class="line"># <span class="keyword">Register</span> your models here.</span><br><span class="line">admin.site.<span class="keyword">register</span>(Publisher)</span><br><span class="line">admin.site.<span class="keyword">register</span>(Author)</span><br><span class="line">admin.site.<span class="keyword">register</span>(Book)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="表单"><strong>表单</strong></h2><h3 id="获取request对象数据"><strong>获取request对象数据</strong></h3><p>&emsp;视图函数<code>hello(request)</code>中的第一个参数是一个<strong>HttpRequest对象</strong>，我们可以通过此对象获取一些有用信息。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> HttpResponse(<span class="string">"Hello world"</span>)</span><br></pre></td></tr></table></figure></p>
<p>&emsp;HttpRequest对象包含当前请求URL的一些信息：</p>
<ul>
<li>request.path：除域名以外的请求路径，以正斜杠开头。例如：”/hello/“</li>
<li>request.get_host()：主机名（比如，通常所说的域名）。    例如：”127.0.0.1:8000” or “www.example.com”</li>
<li>request.get_full_path()：请求路径，可能包含查询字符串。例如：”/hello/?print=true”</li>
<li>request.is_secure()：如果通过HTTPS访问，则此方法返回True; 否则返回False。    </li>
</ul>
<h3 id="HTTP_Header信息"><strong>HTTP Header信息</strong></h3><p>&emsp;<strong><code>request.META</code></strong>是一个Python字典，包含了所有本次HTTP请求的Header信息<br>&emsp;利用request.META获取HTTP Header信息：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ua_display_good2</span><span class="params">(request)</span>:</span></span><br><span class="line">   ua = request.META.get(<span class="string">'HTTP_USER_AGENT'</span>, <span class="string">'unknown'</span>)</span><br><span class="line">   <span class="keyword">return</span> HttpResponse(<span class="string">"Your browser is %s"</span> % ua)</span><br></pre></td></tr></table></figure></p>
<h4 id="利用模板列出所有HTTP_Header信息实例"><strong>利用模板列出所有HTTP Header信息实例</strong></h4><ul>
<li><p>创建模板——<strong><code>mysite/templates/displayHeaderTemp.html</code></strong></p>
  <figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"content-type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">title</span>&gt;</span></span><span class="template_tag">&#123;% <span class="keyword">block</span> title %&#125;</span><span class="xml"></span><span class="template_tag">&#123;% <span class="keyword">endblock</span> %&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">body</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="title">ul</span>&gt;</span> </span><br><span class="line">			</span><span class="template_tag">&#123;% <span class="keyword">for</span> tkey, tvalue <span class="keyword">in</span> headDict.iteritems %&#125;</span><span class="xml"></span><br><span class="line">				<span class="tag">&lt;<span class="title">li</span>&gt;</span></span><span class="variable">&#123;&#123;tkey&#125;&#125;</span><span class="xml">: </span><span class="variable">&#123;&#123;tvalue&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">			</span><span class="template_tag">&#123;% <span class="keyword">endfor</span> %&#125;</span><span class="xml"></span><br><span class="line">		<span class="tag">&lt;/<span class="title">ul</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="title">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加视图函数——<strong><code>mysite/views.py</code></strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render_to_response</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">displayHeaderTemp</span><span class="params">(request)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> render_to_response(<span class="string">'displayHeaderTemp.html'</span>, &#123;<span class="string">'title'</span>: <span class="string">'displayHeaderTemplate'</span>, <span class="string">'headDict'</span>: request.META&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置URL——<strong><code>mysite/urls.py</code></strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysite.views <span class="keyword">import</span> displayHeaderTemp</span><br><span class="line">urlpatterns = patterns(</span><br><span class="line">    url(<span class="string">r'^displayHeaderTemp/$'</span>, displayHeaderTemp),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="获取表单提交的数据"><strong>获取表单提交的数据</strong></h3><ul>
<li><strong><code>request.GET</code></strong>：获取用户通过GET方法提交的表单数据(参数URL中可见)</li>
<li><strong><code>request.POST</code></strong>：获取用户通过POST方法提交的表单数据</li>
</ul>
<h4 id="实例一"><strong>实例一</strong></h4><p>&emsp;用户通过searchForm页面GET方法提交表单数据，跳转到search页面，通过request.GET获取用户提交数据并在页面显示</p>
<ul>
<li><p>创建模板——<strong><code>templates/searchForm.html</code></strong></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="title">head</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"content-type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">title</span>&gt;</span>search form<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">head</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="title">body</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"/search/"</span> <span class="attribute">method</span>=<span class="value">"get"</span> <span class="attribute">accept-charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"q"</span> <span class="attribute">value</span>=<span class="value">""</span>&gt;</span> </span><br><span class="line">           <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Search &amp;rarr;"</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;/<span class="title">form</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="title">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建视图——<strong><code>books/views.py</code></strong><br>  &emsp;<code>books/views.py</code>是在books这个app里的视图，非<code>mysite/views.py</code></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, render_to_response</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">searchForm</span><span class="params">(request)</span>:</span></span><br><span class="line">	 <span class="keyword">return</span> render_to_response(<span class="string">'searchForm.html'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(request)</span>:</span></span><br><span class="line">	 <span class="keyword">if</span> <span class="string">'q'</span> <span class="keyword">in</span> request.GET:</span><br><span class="line">			message = <span class="string">"You search for: %s"</span> % request.GET[<span class="string">'q'</span>]</span><br><span class="line">	 <span class="keyword">else</span>:</span><br><span class="line">			message = <span class="string">"You sumit an empty form."</span></span><br><span class="line">	  <span class="keyword">return</span> HttpResponse(message)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置URL——<strong><code>mysite/urls.py</code></strong><br>  &emsp;因为searchForm会跳转到search，url配置中必须有search及相对于的视图函数</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> books <span class="keyword">import</span> views</span><br><span class="line">urlpatterns = patterns(<span class="string">''</span>, </span><br><span class="line">       url(<span class="string">r'^searchForm/'</span>, views.searchForm),</span><br><span class="line">       url(<span class="string">r'^search/'</span>, views.search),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="实例二"><strong>实例二</strong></h4><p>&emsp;利用Django提交表单发送邮件</p>
<ul>
<li><p>邮件设置——<strong><code>mysite/setting.py</code></strong></p>
  <figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#email setting</span></span><br><span class="line"><span class="comment">#EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'</span></span><br><span class="line">EMAIL_HOST = 'smtp.163.com'</span><br><span class="line">EMAIL_PORT = 25</span><br><span class="line">EMAIL_HOST_USER = 'xxxxx<span class="comment">@163.com'</span></span><br><span class="line">EMAIL_HOST_PASSWORD = '<span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span><span class="keyword">*</span>'</span><br><span class="line">EMAIL_USE_TLS = True</span><br><span class="line"><span class="comment">#EMAIL_SUBJECT_PREFIX = u'Django邮件测试'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试利用Django发送邮件<br>  &emsp;返回<code>1</code>则成功，<code>0</code>则失败</p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&gt; python manage<span class="class">.py</span> shell</span><br><span class="line">&gt;&gt;&gt; from django<span class="class">.core</span><span class="class">.mail</span> import send_mail</span><br><span class="line">&gt;&gt;&gt; <span class="function"><span class="title">send_mail</span><span class="params">(<span class="string">'DjangoMail'</span>,<span class="string">'test'</span>,<span class="string">'autodeploy@163.com'</span>, [<span class="string">'221bmogl@gmail.com'</span>], fail_silently=True)</span></span></span><br></pre></td></tr></table></figure>
<p>  send_mail()函数参数解释：</p>
<ul>
<li>send_mail(subject, message, from_email, recipient_list, fail_silently=False, auth_user=None,auth_password=None, connection=None)</li>
<li><p>subject, message, from_email and recipient_list 这四个参数是必须的。</p>
</li>
<li><p>subject: 字符串，表示邮件标题。</p>
</li>
<li>message: 字符串，表示邮件内容。</li>
<li>from_email: 字符串，表示发件邮箱。</li>
<li>recipient_list: 字符串列表，列表中每个成员都是一个邮箱地址，而且每个收件人都会在 “收件人/To:” 栏看到出现在 recipient_list 中的其他收件人。</li>
<li>fail_silently: （可选）布尔值。为 False 时， send_mail 会抛出 smtplib.SMTPException 异常。 smtplib 文档列出了所有可能的异常。 这些异常都是 SMTPException 的子类。</li>
<li>auth_user: （可选）SMTP服务器的认证用户名。没提供该参数的情况下，Django会使用 EMAIL_HOST_USER 配置项的设置。</li>
<li>auth_password: （可选）SMTP服务器的认证密码，没提供该参数的情况下，Django会使用EMAIL_HOST_PASSWORD 配置项的设置。</li>
<li>connection: （可选）发送邮件的后端。没提供该参数的情况下，Django会使用默认后端的实例。可查看 Email backends 了解更多细节。</li>
</ul>
</li>
<li><p>创建模板——<strong><code>templates/contactForm.html</code></strong></p>
  <figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"content-type"</span> <span class="attribute">content</span>=<span class="value">"text/html; charset=utf-8"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">title</span>&gt;</span>Contact us<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">h1</span> <span class="attribute">id</span>=<span class="value">"content1"</span>&gt;</span>Contact us<span class="tag">&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line">	</span><span class="template_tag">&#123;% <span class="keyword">if</span> error %&#125;</span><span class="xml"></span><br><span class="line">		<span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">		</span><span class="template_tag">&#123;% <span class="keyword">for</span> eachError <span class="keyword">in</span> error %&#125;</span><span class="xml"></span><br><span class="line">		<span class="tag">&lt;<span class="title">li</span>&gt;</span> </span><span class="variable">&#123;&#123;eachError&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">		</span><span class="template_tag">&#123;% <span class="keyword">endfor</span> %&#125;</span><span class="xml"></span><br><span class="line">		<span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">	</span><span class="template_tag">&#123;% <span class="keyword">endif</span> %&#125;</span><span class="xml"></span><br><span class="line"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">""</span> <span class="attribute">method</span>=<span class="value">"post"</span> <span class="attribute">accept-charset</span>=<span class="value">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 此处需要</span></span><span class="template_tag">&#123;% <span class="keyword">csrf_token</span> %&#125;</span><span class="xml"><span class="comment">、不然会CSRF验证失败! --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">span</span> <span class="attribute">style</span>=<span class="value">"color: #ff0000;"</span>&gt;</span></span><span class="template_tag">&#123;% <span class="keyword">csrf_token</span> %&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span>Subject: <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"subject"</span> <span class="attribute">value</span>=<span class="value">"</span></span></span><span class="variable">&#123;&#123;subject&#125;&#125;</span><span class="xml"><span class="tag"><span class="value">"</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span>Your e-mail(optional): <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"email"</span> <span class="attribute">value</span>=<span class="value">"</span></span></span><span class="variable">&#123;&#123;email&#125;&#125;</span><span class="xml"><span class="tag"><span class="value">"</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span>Message: <span class="tag">&lt;<span class="title">textarea</span> <span class="attribute">name</span>=<span class="value">"message"</span> <span class="attribute">rows</span>=<span class="value">"8"</span> <span class="attribute">cols</span>=<span class="value">"40"</span>&gt;</span></span><span class="variable">&#123;&#123;message&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="title">textarea</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">p</span>&gt;</span><span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span> <span class="attribute">value</span>=<span class="value">"Continue &amp;rarr;"</span>&gt;</span><span class="tag">&lt;/<span class="title">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建视图函数——<strong><code>mysite/views.py</code></strong></p>
  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def <span class="function"><span class="title">contact</span><span class="params">(request)</span></span>:</span><br><span class="line">error = []</span><br><span class="line">   <span class="keyword">if</span> request<span class="class">.method</span> == <span class="string">'POST'</span>:</span><br><span class="line">       <span class="keyword">if</span> not request<span class="class">.POST</span><span class="class">.get</span>(<span class="string">'subject'</span>):</span><br><span class="line">           error.<span class="function"><span class="title">append</span><span class="params">(<span class="string">'Enter a subject'</span>)</span></span></span><br><span class="line">       <span class="keyword">if</span> not request<span class="class">.POST</span><span class="class">.get</span>(<span class="string">'message'</span>):</span><br><span class="line">           error.<span class="function"><span class="title">append</span><span class="params">(<span class="string">'Enter a message'</span>)</span></span></span><br><span class="line">       <span class="keyword">if</span> request<span class="class">.POST</span><span class="class">.get</span>(<span class="string">'email'</span>) and <span class="string">'@'</span> not <span class="keyword">in</span> request<span class="class">.POST</span>[<span class="string">'email'</span>]:</span><br><span class="line">           error.<span class="function"><span class="title">append</span><span class="params">(<span class="string">'Enter a valid email address:'</span>)</span></span></span><br><span class="line">       <span class="keyword">if</span> not error:</span><br><span class="line">           emailMessage = <span class="string">': '</span>.<span class="function"><span class="title">join</span><span class="params">([request.POST.get(<span class="string">'email'</span>, <span class="string">'UserEmailEmpty'</span>)</span></span>, request<span class="class">.POST</span>[<span class="string">'message'</span>]])</span><br><span class="line">           send_mail(</span><br><span class="line">               request<span class="class">.POST</span>[<span class="string">'subject'</span>],</span><br><span class="line">               emailMessage,</span><br><span class="line">               <span class="string">'xxxxx@163.com'</span>,</span><br><span class="line">               [<span class="string">'fatesai@gmail.com'</span>],</span><br><span class="line">               fail_silently=True,</span><br><span class="line">               ) </span><br><span class="line">               <span class="id">#return</span> <span class="function"><span class="title">HttpResponseRedirect</span><span class="params">(<span class="string">'/contact/thanks/'</span>, RequestContext(request)</span></span>)</span><br><span class="line">               return <span class="function"><span class="title">HttpResponseRedirect</span><span class="params">(<span class="string">'/contact/thanks/'</span>)</span></span></span><br><span class="line">   return <span class="function"><span class="title">render_to_response</span><span class="params">(<span class="string">'contactForm.html'</span>, RequestContext(request, &#123;<span class="string">'error'</span>: error&#125;)</span></span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>URL设置——<strong><code>mysite/urls.py</code></strong></p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mysite.views <span class="keyword">import</span> contact, thanks</span><br><span class="line">urlpatterns = patterns(<span class="string">''</span>,</span><br><span class="line">	 url(<span class="string">r'^contactus/'</span>, contact),</span><br><span class="line">	url(<span class="string">r'^contact/thanks/'</span>, thanks)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
</ul>

				</div>

				

					<div class="content-tag">

						 <a class="tag-link" href="/tags/Django/">Django</a>

					</div>

				

			</article>

			<div class="content-nav">

				
					<a href="/2015/11/16/Django-works/" title="Django残作记">&larr; Prev</a>
				

				
					<a href="/2015/11/11/ddos/" title="DDOS浅记">Next &rarr;</a>
				

			</div>

		</div>


	</div>

	<div class="row">
	<p class="theme">Powered: <a href="http://hexo.io/"  target="_blank">Hexo</a>, Theme: <a href="https://github.com/samwhelp/hexo-theme-nadya" target="_blank">Nadya</a> remastered from <a href="https://github.com/nadymain/hexo-theme-nadymain" target="_blank">NadyMain</a></p>
</div>

	<!-- <div class="row">
	<p class="theme">Powered: <a href="http://hexo.io/"  target="_blank">Hexo</a>, Theme: <a href="https://github.com/samwhelp/hexo-theme-nadya" target="_blank">Nadya</a> remastered from <a href="https://github.com/nadymain/hexo-theme-nadymain" target="_blank">NadyMain</a></p>
</div>
 -->

</body>
</html>
