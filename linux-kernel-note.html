<!DOCTYPE html>
<html lang="zh-Hant-TW">

	

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title> 墨 痕 </title>
	<meta property="og:title" content=" 《深入理解Linux内核》阅读笔记 | Hexo " />
	<meta name="twitter:title" content=" 《深入理解Linux内核》阅读笔记 | Hexo ">

	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary">

	<meta name="description" content=" 《深入理解Linux内核》阅读笔记 | Hexo ">
	<meta property="og:description" content=" 《深入理解Linux内核》阅读笔记 | Hexo " />
	<meta name="twitter:description" content=" 《深入理解Linux内核》阅读笔记 | Hexo " />

	<link rel="icon" type="image/x-icon" href="http://yoursite.com/asset/img/favicon.png">

	<link rel="image_src" href="http://yoursite.com/asset/img/logo.png" >
	<meta property="og:image" content="http://yoursite.com/asset/img/logo.png" />

	
	<link href="http://yoursite.com/atom.xml" title="Hexo" type="application/atom+xml" rel="alternative">
	

	<link rel="canonical" href="/linux-kernel-note.html">

	<link rel="stylesheet" href="/asset/css/main.css">

</head>


<body>

	
	<header class="site-header">

		
		<nav class="nav-page">

			<div class="row">

				<ul>

					

					<li><a href="/">Home</a></li>

					

					<li><a href="/archives">Sitemap</a></li>

					

					<li><a href="/atom.xml">Rss</a></li>

					

				</ul>

			</div>

		</nav>


		<div class="site-header-main">

			<div class="row">

				<h1><a href="/">墨 痕</a></h1>
				<h6><a href="/">fatesai#gmail.com</a></h6>

				

			</div>

		</div>

		


		<nav class="nav-cat">

			<div class="row">

				<ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/OPS/">OPS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCP-IP/">TCP/IP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li></ul>

			</div>

		</nav>




	</header>


	<div id="content" class="site-content">

		
<div class="row content-page">

	<article itemscope itemtype="http://schema.org/Article">

		<h2 class="content-title"><a href="/linux-kernel-note.html" itemprop="url"><span itemprop="name">《深入理解Linux内核》阅读笔记</span></a></h2>

		<div class="content" itemprop="articleBody">

			<h2 id="绪论"><strong>绪论</strong></h2><h3 id="Unix文件系统概述"><strong>Unix文件系统概述</strong></h3><h4 id="文件"><strong>文件</strong></h4><p>&emsp;Unix文件是以字节序列组成的信息载体，文件被组织在一个树结构的命名空间中。除叶节点外，树的所有节点表示目录名。目录节点包含其下的文件及目录的所有信息。<br>&emsp;Unix的进程都有一个当前目录，当前目录属于进程执行上下文(execution context)，标识进程所在的当前目录。进程使用<strong>路径名(pcothname)</strong>标识某个特定文件，路径名由斜杠及一系列指向文件的目录名交替组成。若路径名的第一个字符为’/‘，则此路径为<strong>绝对路径</strong>；若第一项为目录名或文件名，则此路径为<strong>相对路径</strong>，<code>.</code>标识当前目录、<code>..</code>标识父目录。</p>
<h4 id="软链接_&amp;_硬链接"><strong>软链接 &amp; 硬链接</strong></h4><p>&emsp;使用<strong><code>ln</code></strong>命令为由路径<code>P1</code>标识的文件创建一个名为<code>P2</code>的硬链接<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&gt;</span> ln <span class="constant">P1 P2</span></span><br></pre></td></tr></table></figure></p>
<p>&emsp;硬链接有2个限制：</p>
<ol>
<li>不能为目录创建硬链接</li>
<li>只能在同一文件系统中创建硬链接</li>
</ol>
<p>&emsp;软链接又可称之为符号链接。路径名可指向位于任意文件系统的任意文件或目录，甚至可指向一个不存在的文件。同样使用<strong><code>ln</code></strong>命令创建软链接<br>&emsp;创建一个名为<code>P2</code>的软链接并指向路径名<code>P1</code>，任何对<code>P2</code>的操作都会自动转换到<code>P1</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; ln <span class="operator">-s</span> P1 P2</span><br></pre></td></tr></table></figure></p>
<h4 id="文件类型"><strong>文件类型</strong></h4><p>&emsp;Unix文件类型包括如下：</p>
<ul>
<li>普通文件</li>
<li>目录</li>
<li>软链接(符号链接)</li>
<li>块设备文件</li>
<li>字符设备文件</li>
<li>管道、命名管道</li>
<li>套接字(socket)</li>
</ul>
<h4 id="文件描述符_&amp;_索引节点"><strong>文件描述符 &amp; 索引节点</strong></h4><p>&emsp;除设备文件和特殊文件系统文件外，Unix文件都由字符序列组成。Unix对文件的内容和描述文件的信息加以区分，文件内容不包含控制信息(文件长度、文件结束符等)。<br>&emsp;文件系统处理文件所需的控制信息都包含在<strong>索引节点</strong>(<strong>inode</strong>)中。每个文件都有自己的索引节点，文件系统用索引节点标识文件。<br>&emsp;索引节点(inode)包含如下属性：</p>
<ul>
<li>文件类型</li>
<li>与文件相关的硬链接个数</li>
<li>以字节为单位的文件长度</li>
<li>设备标识符</li>
<li>文件系统中标识文件的索引节点号</li>
<li>文件拥有者ID</li>
<li>文件的组ID</li>
<li>时间戳(改变时间、最后访问时间、最后修改时间)</li>
<li>访问权限及文件模式</li>
</ul>
<h4 id="访问权限"><strong>访问权限</strong></h4><p>&emsp;文件的潜在用户分三类：</p>
<ul>
<li>文件拥有者</li>
<li>同组用户，不包括拥有者</li>
<li>所有剩下的用户</li>
</ul>
<p>&emsp;访问权限有三种：读、写和可执行。因此文件访问权限的组合有九种不同的二进制标记。除此之外，还有三种附加标记——<strong><code>suid</code></strong>、<strong><code>sgid</code></strong>和<strong><code>sticky</code></strong>用于定义文件模式。</p>
<ul>
<li><code>suid</code>：进程执行文件时保持文件拥有者的UID。</li>
<li><code>sgid</code>：进程执行文件时保持用户组的GID。</li>
<li><code>sticky</code>：向内核发出请求，当程序结束后依然将其保存在内存中(此标志已过时)。</li>
</ul>
<h3 id="Unix内核概述"><strong>Unix内核概述</strong></h3><h4 id="进程/内核模式"><strong>进程/内核模式</strong></h4><p>&emsp;CPU可运行在用户态下，也可运行在内核态下。尽管CPU会拥有不同的执行状态，但标准的Unix内核仅用到用户态和内核态。<br>&emsp;一个程序在执行时，大部分时间处于用户态下，只有需要内核所提供的服务时才切换到内核态，程序在用户态下不能直接访问内核数据结构和内核程序。当内核满足用户程序请求后，内核会让程序重新回到用户态。<br>&emsp;请求内核服务的进程使用<strong>系统调用(system call)</strong>的特殊编程机制完成从用户态到内核态的转换(系统调用只是其中的一种方式)。每个系统调用都设置一组识别进程请求的参数，进程调用后执行与硬件相关的CPU指令。<br>&emsp;除用户进程外，Unix系统还有几个<strong>内核线程(kernel thread)</strong>的<strong>特权进程</strong>，特权进程有如下特点：</p>
<ul>
<li>以内核态运行在内核地址空间中</li>
<li>不与用户直接交互、不需要终端设备</li>
<li>在系统启动时创建，一直处于活跃状态直到系统关闭</li>
</ul>
<h4 id="进程实现"><strong>进程实现</strong></h4><p>&emsp;为了内核能管理进程，每个进程由<strong>进程描述符(process descriptor)</strong>表示，进程描述符包含有关进程当前状态的信息。<br>&emsp;当内核需要暂停一个正在执行中的进程时，会把相关处理器寄存器的内容保存到进程描述符中，这些寄存器包括：</p>
<ul>
<li>程序计数器(PC)和栈指针(SP)寄存器</li>
<li>通用寄存器</li>
<li>浮点寄存器</li>
<li>包含CPU状态信息的处理器控制寄存器</li>
<li>用来跟踪进程对RAM访问的内存管理寄存器</li>
</ul>
<p>&emsp;当内核需要恢复一个进程时，会用进程描述符中合适的字段来装载寄存器。<br>&emsp;当进程不在CPU上执行时，那正在等待事件。内核可区分多种等待状态，这些等待状态由进程描述符队列实现，每个队列对应一组正在等待某事件的进程。</p>
<h4 id="可重入内核"><strong>可重入内核</strong></h4><p>&emsp;所有Unix内核都是<strong>可重入的(reentrant)</strong>，可重入意味着多个进程可同时在内核态下执行。<br>&emsp;提供可重入的其中一种方式是编写可重入函数，可重入函数只能修改局部变量而不能修改全局变量。对于非重入函数，可利用锁机制保证一次只有一个进程执行一个非重入函数。<br>&emsp;进程即使处于内核态，当一个硬件中断产生时，可重入内核也能将正在执行的进程挂起。产生硬件中断的设备控制器能快速的收到内核的应答，设备控制器在CPU处理中断时能执行其他任务，这样能提高设备控制器的吞吐量。<br>&emsp;为了说明可重入性对内核组织的影响。引入<strong>内核控制路径(kernel control path)</strong>概念，内核控制路径表示内核处理系统调用、异常或中断所执行的指令序列。<br>&emsp;最简单的情况下，CPU从第一条指令到最后一条指令顺序执行内核控制路径。但当以下事件之一发生时，CPU交错执行内核控制路径：</p>
<ul>
<li>用户态下的进程调用一个系统调用，相应的内核控制路径确定这个请求无法立即满足。于是，内核控制路径调用调度程序选择一个新的进程执行。因此发生进程切换。第一个内核控制路径没完成，CPU便开始执行其他的内核控制路径。此情况下，两条控制路径代表两个不同的进程在执行。</li>
<li>当正在执行一个内核控制路径时，CPU检测到一个异常，第一个控制路径被挂起而CPU开始执行合适的过程。</li>
<li>当CPU正在运行一个启用了中断的内核控制路径时，一个硬件中断产生。第一个内核控制路径还未执行完，CPU开始执行另一个内核控制路径来处理中断，中断处理完后第一个内核控制路径恢复。</li>
<li>在支持抢占式调度的内核中，若一个更高优先级的进程进入调度队列，则CPU会中断第一个执行控制路径，优先响应更高优先级的进程。</li>
</ul>


		</div>

	</article>

</div>


	</div>

	<div class="row">
	<p class="theme">Powered: <a href="http://hexo.io/"  target="_blank">Hexo</a>, Theme: <a href="https://github.com/samwhelp/hexo-theme-nadya" target="_blank">Nadya</a> remastered from <a href="https://github.com/nadymain/hexo-theme-nadymain" target="_blank">NadyMain</a></p>
</div>

	<!-- <div class="row">
	<p class="theme">Powered: <a href="http://hexo.io/"  target="_blank">Hexo</a>, Theme: <a href="https://github.com/samwhelp/hexo-theme-nadya" target="_blank">Nadya</a> remastered from <a href="https://github.com/nadymain/hexo-theme-nadymain" target="_blank">NadyMain</a></p>
</div>
 -->

</body>
</html>
